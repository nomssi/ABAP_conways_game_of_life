<%@page language="abap" %>                                                                                                                                                                                                                                     
<html>                                                                                                                                                                                                                                                         
  <head>                                                                                                                                                                                                                                                       
    <meta http-equiv="content-type" content="text/html; charset=utf-8">                                                                                                                                                                                        
    <meta http-equiv="X-UA-Compatible" content="IE=11,10,9,8" />                                                                                                                                                                                               
    <script>                                                                                                                                                                                                                                                   
        window.onload = function() {                                                                                                                                                                                                                           
          if (!window.WebSocket){                                                                                                                                                                                                                              
              alert("BROWSER NOT SUPPORTED");                                                                                                                                                                                                                  
              return;                                                                                                                                                                                                                                          
          }                                                                                                                                                                                                                                                    
          var ws_url = window.location.origin + '/sap/bc/apc/sap/zapc_wakeup';                                                                                                                                                                                 
          var ws_url = ws_url.replace('http','ws');                                                                                                                                                                                                            
          try {                                                                                                                                                                                                                                                
            ws = new WebSocket(ws_url);                                                                                                                                                                                                                        
          } catch (err) {                                                                                                                                                                                                                                      
            alert(err);                                                                                                                                                                                                                                        
          }                                                                                                                                                                                                                                                    
          ws.onopen = function(){                                                                                                                                                                                                                              
          }                                                                                                                                                                                                                                                    
          ws.onmessage = function(msg){                                                                                                                                                                                                                        
            if (msg.data == '__CLOSE__') {                                                                                                                                                                                                                     
              ws.close();                                                                                                                                                                                                                                      
              return;                                                                                                                                                                                                                                          
            }                                                                                                                                                                                                                                                  
            document.getElementById('text').innerHTML = msg.data;                                                                                                                                                                                              
            var form = document.createElement("form");                                                                                                                                                                                                         
            form.setAttribute("method", "post");                                                                                                                                                                                                               
            form.setAttribute("action", "sapevent:123" );                                                                                                                                                                                                      
            var hiddenField = document.createElement("input");                                                                                                                                                                                                 
            hiddenField.setAttribute("type", "hidden");                                                                                                                                                                                                        
            hiddenField.setAttribute("name", "text");                                                                                                                                                                                                          
            hiddenField.setAttribute("value", msg.data);                                                                                                                                                                                                       
            form.appendChild(hiddenField);                                                                                                                                                                                                                     
            document.body.appendChild(form);                                                                                                                                                                                                                   
            form.submit();                                                                                                                                                                                                                                     
          }                                                                                                                                                                                                                                                    
          ws.onclose = function(msg){                                                                                                                                                                                                                          
          }                                                                                                                                                                                                                                                    
        }                                                                                                                                                                                                                                                      
    </script>                                                                                                                                                                                                                                                  
  </head>                                                                                                                                                                                                                                                      
  <body>                                                                                                                                                                                                                                                       
    <b id='text'></b>                                                                                                                                                                                                                                          
  </body>                                                                                                                                                                                                                                                      
</html>                                                                                                                                                                                                                                                        